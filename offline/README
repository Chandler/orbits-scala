ported from JS app
TODO: rewrite this in scala